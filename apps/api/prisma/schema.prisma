// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  manager
  staff
}

enum Status {
  active
  inactive
}

enum AttendanceStatus {
  attendance
  absent
  late
  excused
}

model User {
  id         Int      @id @default(autoincrement())
  account    String   @unique
  password   String
  username   String
  role       Role?    @default(staff)
  email      String?  @unique
  status     Status?  @default(active)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  schools     School[]
  courses     Course[]
  students    Student[]
  gradesheets GradeSheet[]
  attendances Attendance[]
}

model School {
  id          Int      @id @default(autoincrement())
  code        String   @unique
  name        String
  description String?
  address     String?
  is_active   Boolean? @default(true)
  modifier_id Int?
  modifier    User?    @relation(fields: [modifier_id], references: [id], onDelete: SetNull)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  courses Course[]
}

model Course {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  grade       Int
  school_id   Int
  school      School   @relation(fields: [school_id], references: [id], onDelete: Cascade)
  start_time  DateTime
  end_time    DateTime
  day_of_week String // 例如："1,3,5" 表示週一、三、五
  duration    Int // 課程持續時間（分鐘）
  modifier_id Int?
  modifier    User?    @relation(fields: [modifier_id], references: [id], onDelete: SetNull)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  students Student[]
}

model Student {
  id          Int      @id @default(autoincrement())
  name        String
  number      String
  gender      String
  course_id   Int
  course      Course   @relation(fields: [course_id], references: [id], onDelete: Cascade)
  is_active   Boolean? @default(true)
  modifier_id Int?
  modifier    User?    @relation(fields: [modifier_id], references: [id], onDelete: SetNull)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  attendances Attendance[]
  gradesheets GradeSheet[]
}

model Attendance {
  id          Int              @id @default(autoincrement())
  student_id  Int
  student     Student          @relation(fields: [student_id], references: [id], onDelete: Cascade)
  date        DateTime
  status      AttendanceStatus
  modifier_id Int?
  modifier    User?            @relation(fields: [modifier_id], references: [id], onDelete: SetNull)
  created_at  DateTime         @default(now())
  updated_at  DateTime         @updatedAt
}

model GradeSheet {
  id          Int      @id @default(autoincrement())
  student_id  Int
  student     Student  @relation(fields: [student_id], references: [id], onDelete: Cascade)
  score       Float
  description String?
  exam_date   DateTime
  modifier_id Int?
  modifier    User?    @relation(fields: [modifier_id], references: [id], onDelete: SetNull)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
}
